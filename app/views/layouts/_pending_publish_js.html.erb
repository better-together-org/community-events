<script id="pending-publish-indicator" type="text/javascript">
  var PublishableChecker = {
    init : function() {
      var lastPublishableItemCount = 0;

      function checkForPublishableChanges() {
        $.ajax({
          url : "<%= baseUri + '/publisher/pending_count.json' %>",

          success : function(response) {
            var count = response.count;
            if (count > 0) {
              if (count != lastPublishableItemCount) {
                // console.log("updated");
                if ($("#pending-change-count, .publication-countlabel").length > 0) {
                  $("#pending-change-count").html(count);
                  $(".publication-count-num").html(count);
                  lastPublishableItemCount = count;
                  // console.log("updated-in-place");
                } else {
                  var $pendingBadge =  $('<span id="pending-change-count" class="badge navigation-badge navigation-badge-blink" style="font-size: 10px;">' + count +'</span>').fadeIn(1000);
                  var $pendingLabel = $("<span class='label label-warning publication-count-label'><i class='publication-count-num'>" + count + "</i>&nbsp;&nbsp;<%= t('pending-updates') %></span>");
                  var $overviewLabel = $("<a class='pending-changes-count-badge' href='<%= baseUri %>/pages/publications_dash/online#program_publish_review'></a>").append($pendingLabel.clone()).fadeIn(1000);

                  $("#public-sites-icon").fadeOut(500).replaceWith($pendingBadge);
                  $("#publish-changes-nav-option").append("&nbsp;&nbsp;").append($pendingLabel);
                  $("#overview-publish-changes-nav-item").append("&nbsp;&nbsp;").append($overviewLabel);

                  lastPublishableItemCount = count;
                  // console.log("updated-with-new-elems");
                };
              };
            };
          }
        });
      };

      checkForPublishableChanges();
      setInterval(function() {
        checkForPublishableChanges();
      }, 30000);

    }
  };
  
  $(document).ready(function() {
    
    PublishableChecker.init();

  });
</script>